function tops(){
  # List the top 10 processes by memory usage or CPU usage
  if [ $# -eq 0 ]; then
      ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%cpu | head
  else
      ps -eo pid,ppid,cmd,%mem,%cpu --sort=-$1 | head
  fi
}

function pathappend() {
  # Add directories to the PATH if not already there.
  # Directories will only be added if the path exists and is not already in the PATH
  # Usage: pathappend dir1 dir2 dir3 ...
  for ARG in "$@"
  do
    eval extra_path=$ARG
    if [ -d "$extra_path" ] && [[ ":$PATH:" != *":$extra_path:"* ]]; then
        PATH="${PATH:+"$PATH:"}$extra_path"
    fi
  done
  unset extra_path
}

function evalornotify() {
  if $(command -v -- $1 > /dev/null 2>&1); then
    eval $2
  else
    echo "$1 has not been installed"
  fi
}

function bak() {
  cp -r $1{,.bak}
}

notify() {
    # Check if 'at' command is available
    if ! command -v at > /dev/null 2>&1; then
        echo "Error: 'at' command is not installed. Install it with: sudo apt install at"
        return 1
    fi

    # Check if there are enough arguments
    if [ "$#" -lt 3 ]; then
        echo "USAGE:"
        echo "    notify <channel> <curl_options> <time>"
        echo
        echo "EXAMPLES:" 
        echo "    notify 'mychannel' -H 'Title: Alert!' -d 'This was detected' now"
        echo "    notify 'mysupersecretchannel' \\"
        echo "           -H 'Title: Unauthorized access detected' \\"
        echo "           -H 'Priority: urgent' \\"
        echo "           -H 'Tags: warning,skull' \\"
        echo "           -d 'Remote access detected. Act right away.' \\"
        echo "           'now + 5 minutes'"
        echo
        echo "TIME FORMATS:"
        echo "    now                 - immediately"
        echo "    'now + 30 minutes'  - 30 minutes from now"
        echo "    'tomorrow 10am'     - tomorrow at 10am"
        echo "    '14:00'             - today at 2pm"
        return 1
    fi

    # Extract the time (last argument)
    local time="${@: -1}"

    # Extract channel (first argument)
    local channel="${1}"

    # Extract the curl command options (all but the first and last argument)
    local curl_options=("${@:2:$#-2}")

    # Check if atd service is running
    if ! systemctl is-active --quiet atd 2>/dev/null; then
        echo "Warning: atd service is not running. Attempting to start it..."
        sudo systemctl start atd 2>/dev/null
        if [ "$?" -ne 0 ]; then
            echo "Error: Could not start atd service. Run: sudo systemctl enable --now atd"
            return 1
        fi
    fi

    # Generate a temporary script for the curl command
    local tmp_script
    tmp_script=$(mktemp)

    # Write the curl command with properly quoted options to the temporary script
    printf 'curl %s ntfy.sh/%s\n' "$(printf '%q ' "${curl_options[@]}")" "${channel}" > "${tmp_script}"

    # Schedule the command using 'at'
    if at "${time}" < "${tmp_script}" 2>&1; then
        echo "Notification scheduled for ${time}"
        echo "Channel: ${channel}"
    else
        echo "Failed to schedule notification at ${time}"
        rm "${tmp_script}"
        return 1
    fi

    # Clean up the temporary script
    rm "${tmp_script}"
}




